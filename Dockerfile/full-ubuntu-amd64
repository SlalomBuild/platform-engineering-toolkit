FROM ubuntu:latest

RUN apt update -yq && apt upgrade -yq && apt install -yq ca-certificates apt-transport-https wget curl bash jq figlet unzip zip git shellcheck nano tar

# Install languages, libraries and frameworks
RUN apt install -yq nodejs npm python3 python3-pip golang && rm -rf /var/lib/apt/lists/*

# Install terraform (https://github.com/hashicorp/terraform)
RUN export tfrelease="$(curl -Ls -o /dev/null -w %{url_effective} https://github.com/hashicorp/terraform/releases/latest | awk -F / '{print substr($NF,2);}')" \
  && echo "Installing terraform v${tfrelease}" \
  && wget https://releases.hashicorp.com/terraform/${tfrelease}/terraform_${tfrelease}_linux_amd64.zip \
  && unzip terraform_${tfrelease}_linux_amd64.zip \
  && mv terraform /usr/bin/terraform \
  && rm terraform_${tfrelease}_linux_amd64.zip

# Install atmos (https://github.com/cloudposse/atmos)
RUN export atmosrelease="$(curl -Ls -o /dev/null -w %{url_effective} https://github.com/cloudposse/atmos/releases/latest | awk -F / '{print substr($NF,2);}')" \
  && echo "Installing atmos v${atmosrelease}" \
  && wget https://github.com/cloudposse/atmos/releases/download/v${atmosrelease}/atmos_${atmosrelease}_linux_amd64 \
  && mv atmos_${atmosrelease}_linux_amd64 /usr/bin/atmos \
  && chmod +x /usr/bin/atmos

# Removing until specifically required - it's a horrible tool anyway!
# Install aws-azure-login (https://github.com/aws-azure-login/aws-azure-login)
# RUN npm install -g aws-azure-login --unsafe-perm \
#   && chmod -R go+rx $(npm root -g)

# Install terraform-docs
RUN export tfdocsrelease="$(curl -Ls -o /dev/null -w %{url_effective} https://github.com/terraform-docs/terraform-docs/releases/latest | awk -F / '{print substr($NF,2);}')" \
  && echo "Installing terraform-docs v${tfdocsrelease}" \
  && wget https://github.com/terraform-docs/terraform-docs/releases/download/v${tfdocsrelease}/terraform-docs-v${tfdocsrelease}-linux-amd64.tar.gz \
  && tar -xzf terraform-docs-v${tfdocsrelease}-linux-amd64.tar.gz -C /usr/bin terraform-docs \
  && rm terraform-docs-v${tfdocsrelease}-linux-amd64.tar.gz \
  && chmod +x /usr/bin/terraform-docs

# Install checkov
RUN export checkovrelease="$(curl -Ls -o /dev/null -w %{url_effective} https://github.com/bridgecrewio/checkov/releases/latest | awk -F / '{print substr($NF,1);}')" \
  && pip install checkov==${checkovrelease}
